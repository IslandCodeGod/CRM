<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CRM System{% endblock %}</title>

    <!-- ç«‹å³åº”ç”¨ä¸»é¢˜ï¼Œé¿å…é—ªçƒ -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    {% block extra_css %}{% endblock %}

    <!-- Favicon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
</head>

<body>
    {% block body %}
    <div class="page-wrapper">
        <!-- ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="nav-brand">
                <span>ğŸ“Š</span>
                <span data-i18n="app.name">CRM System</span>
            </div>

            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="{{ url_for('dashboard.index') }}"
                            class="nav-link {% if request.endpoint and request.endpoint == 'dashboard.index' %}active{% endif %}">
                            <span class="nav-icon">ğŸ </span>
                            <span data-i18n="nav.dashboard">Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('customer.index') }}"
                            class="nav-link {% if request.endpoint and 'customer' in request.endpoint %}active{% endif %}">
                            <span class="nav-icon">ğŸ‘¥</span>
                            <span data-i18n="nav.customers">Customers</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('lead.index') }}"
                            class="nav-link {% if request.endpoint and 'lead' in request.endpoint %}active{% endif %}">
                            <span class="nav-icon">ğŸ¯</span>
                            <span data-i18n="nav.leads">Leads</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('opportunity.index') }}"
                            class="nav-link {% if request.endpoint and 'opportunity' in request.endpoint %}active{% endif %}">
                            <span class="nav-icon">ğŸ’¼</span>
                            <span data-i18n="nav.opportunities">Opportunities</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('contact.index') }}"
                            class="nav-link {% if request.endpoint and 'contact' in request.endpoint %}active{% endif %}">
                            <span class="nav-icon">ğŸ“‡</span>
                            <span data-i18n="nav.contacts">Contacts</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('task.index') }}"
                            class="nav-link {% if request.endpoint and 'task' in request.endpoint %}active{% endif %}">
                            <span class="nav-icon">âœ“</span>
                            <span data-i18n="nav.tasks">Tasks</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('auth.logout') }}" class="nav-link">
                            <span class="nav-icon">ğŸšª</span>
                            <span data-i18n="app.logout">Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <div style="margin-top: auto; padding-top: 2rem; border-top: 1px solid var(--border-color);">
                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                    <p data-i18n="common.current_user">Current User</p>
                    <p style="font-weight: 600; color: var(--text-primary);">{{ current_user.username }}</p>
                </div>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="toast-container">
                {% for category, message in messages %}
                <div class="toast toast-{{ category }}">
                    <div class="toast-message">{{ message }}</div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </main>
    </div>

    <!-- ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
    <button id="themeToggle" class="theme-toggle" title="Toggle Theme">ğŸŒ™</button>

    <!-- è¯­è¨€åˆ‡æ¢æŒ‰é’® -->
    <button id="langToggle" class="theme-toggle" style="bottom: 90px;" title="Switch Language"
        onclick="switchLanguage(currentLanguage === 'en' ? 'zh' : 'en')">ä¸­æ–‡</button>
    {% endblock %}

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
    <script src="{{ url_for('static', filename='js/i18n-helper.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components.js') }}"></script>
    {% block extra_js %}{% endblock %}
</body>

</html>